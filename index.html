<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>1-10 야자 관리 프로그램</title>
<style>
  :root{--bg:#f6f8fb;--card:#fff;--border:#e5e7eb;--text:#0f172a;--sub:#6b7280;--blue:#3b82f6;--red:#ef4444;--shadow:0 8px 24px rgba(15,23,42,.08);--r:14px}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,sans-serif;overflow:hidden;word-break:keep-all}
  .page{max-width:1580px;margin:18px auto;padding:0 14px;height:calc(100% - 36px);display:flex;flex-direction:column;gap:12px}
  header{background:#0b2545;color:#e6f0ff;border-radius:16px;padding:14px 18px;display:flex;justify-content:space-between;align-items:center;gap:10px;box-shadow:var(--shadow)}
  header h1{margin:0;font-size:16px;font-weight:800}
  .meta{font-size:12px;opacity:.9;white-space:nowrap}
  .fit-area{display:grid;grid-template-columns:360px 1fr;gap:14px;height:calc(100% - 72px);transform-origin:top left;padding-bottom:18px}
  .side{display:flex;flex-direction:column;gap:10px}
  .panel{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:12px}
  .panel h2{margin:0 0 10px;font-size:14px;color:#334155}
  .cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .btn{background:#fff;border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-weight:700;cursor:pointer;box-shadow:0 2px 6px rgba(15,23,42,.06)}
  .btn.small{border-radius:8px;padding:6px 9px}
  .btn:active{transform:translateY(1px)}
  .cal-title{font-weight:800}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;font-size:12px;user-select:none}
  .cal-dow{text-align:center;color:#64748b;font-weight:700}
  .cal-day{text-align:center;padding:8px 0;border:1px solid var(--border);border-radius:10px;cursor:pointer;background:#fff}
  .cal-day.other{opacity:.45}
  .cal-day.today{outline:2px solid #3b82f6}
  .cal-day.selected{background:#eff6ff;border-color:#bfdbfe;font-weight:800}
  .timeline{max-height:260px;overflow:auto}
  .tl-empty{color:#64748b;font-size:12px}
  .tl-item{display:flex;justify-content:space-between;padding:6px 8px;border:1px solid var(--border);border-radius:10px;margin-bottom:6px}
  .tl-name{font-weight:800}
  .tl-reason{font-size:12px;color:#64748b}
  .controls{display:flex;gap:8px;margin:0 2px 4px;flex-wrap:wrap;align-items:center}
  .hint{margin-left:auto;color:#6b7280;font-size:12px}
  .grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:12px 14px;display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:auto auto;gap:8px 12px;align-items:center;box-shadow:0 2px 8px rgba(15,23,42,.06);min-height:82px}
  .no{grid-row:1 / span 2;font-weight:800;color:#334155;width:36px;text-align:right;padding-right:6px}
  .name{font-weight:800}
  .id{font-size:12px;color:var(--sub)}
  .status{justify-self:end;align-self:start;display:inline-flex;align-items:center;gap:8px;background:#f8fafc;border:1px solid var(--border);padding:6px 12px;border-radius:999px;cursor:pointer;font-weight:800;font-size:12px;height:30px}
  .pill{width:10px;height:10px;border-radius:999px}
  .present{color:#3b82f6}.present .pill{background:#3b82f6}
  .absent{color:#ef4444}.absent .pill{background:#ef4444}
  .reason-wrap{grid-column:2 / -1;display:flex;align-items:center;gap:8px}
  .reason-label{font-size:11px;color:#64748b;white-space:nowrap}
  .reason{font-size:12px;padding:4px 8px;border:1px solid var(--border);border-radius:8px;background:#fff;visibility:hidden}
  .card.absent .reason{visibility:visible}
  .bottom-space{height:10px}
</style>
</head>
<body>
  <div class="page">
    <header>
      <h1>1-10 야자 관리 프로그램</h1>
      <div class="meta">날짜·시간: <span id="dt"></span> · 보기 날짜: <span id="viewDate"></span></div>
    </header>

    <div id="fitArea" class="fit-area">
      <div class="side">
        <section class="panel">
          <h2>달력</h2>
          <div class="cal-header">
            <button class="btn small" id="prevMonth">←</button>
            <div class="cal-title" id="calTitle"></div>
            <button class="btn small" id="nextMonth">→</button>
          </div>
          <div class="cal-grid" id="calGrid"></div>
        </section>
        <section class="panel">
          <h2>타임라인 (선택 날짜의 불참자)</h2>
          <div id="timeline" class="timeline"></div>
        </section>
      </div>

      <div>
        <div class="controls">
          <button class="btn" id="allPresent">모두 참여</button>
          <button class="btn" id="allAbsent">모두 불참</button>
          <button class="btn" id="goToday">오늘</button>
          <div class="hint">요일 자동 불참은 ‘학원’, 수동 불참은 기본 ‘기타’로 저장됨</div>
        </div>
        <section id="grid" class="grid"></section>
        <div class="bottom-space"></div>
      </div>
    </div>
  </div>

<script>
  const REASONS=['동아리','학원','병원','기타']
  const WEEKDAYS=['일','월','화','수','목','금','토']
  const KEY='selfstudy-1-10_v4'

  const RULES={
    1:['화'],2:['화'],3:['목'],4:['화'],5:['월'],6:['수'],7:['화'],8:['화'],9:['수'],
    11:['수'],12:['수'],13:['화'],14:['수'],15:['월'],16:['수'],17:['수'],18:['화'],
    19:['수'],20:['월'],21:['수'],22:['화'],23:['목'],24:['화'],25:['수'],26:['화'],
    27:['화'],28:['수'],29:['목'],32:['화'],33:['목'],35:['수'],36:['수']
  }

  const studentData=[
    {no:1,id:'11001',name:'강원우'},{no:2,id:'11002',name:'고진용'},{no:3,id:'11003',name:'권범수'},
    {no:4,id:'11004',name:'김민찬'},{no:5,id:'11005',name:'김선규'},{no:6,id:'11006',name:'김영광'},
    {no:7,id:'11007',name:'문강윤'},{no:8,id:'11008',name:'박상호'},{no:9,id:'11009',name:'박준형'},
    {no:10,id:'11010',name:'박지민'},{no:11,id:'11011',name:'석지환'},{no:12,id:'11012',name:'손동현'},
    {no:13,id:'11013',name:'오시훈'},{no:14,id:'11014',name:'오태윤'},{no:15,id:'11015',name:'유이준'},
    {no:16,id:'11016',name:'유태강'},{no:17,id:'11017',name:'유태민'},{no:18,id:'11018',name:'윤영인'},
    {no:19,id:'11019',name:'이권우'},{no:20,id:'11020',name:'이민혁'},{no:21,id:'11021',name:'이승준'},
    {no:22,id:'11022',name:'이승헌'},{no:23,id:'11023',name:'이요셉'},{no:24,id:'11024',name:'이중희'},
    {no:25,id:'11025',name:'이지후'},{no:26,id:'11026',name:'이한별'},{no:27,id:'11027',name:'장우진'},
    {no:28,id:'11028',name:'장재원'},{no:29,id:'11029',name:'전희재'},{no:30,id:'11030',name:'정재욱'},
    {no:31,id:'11031',name:'지민건'},{no:32,id:'11032',name:'천정욱'},{no:33,id:'11033',name:'최동현'},
    {no:34,id:'11034',name:'최윤서'},{no:35,id:'11035',name:'황태민'},{no:36,id:'11036',name:'이주환'}
  ]

  const roster = studentData.map(x=>({no:x.no,id:x.id,name:x.name,status:'present',reason:'기타',manual:false}))

  const weekly={}
  Object.keys(RULES).forEach(k=>{
    const set=new Set(RULES[k].map(dw=>WEEKDAYS.indexOf(dw)).filter(v=>v>=0))
    weekly[+k]=set
  })

  const dtEl=document.getElementById('dt')
  function tick(){
    const d=new Date()
    dtEl.textContent=d.toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric',weekday:'short'})+' · '+d.toLocaleTimeString('ko-KR',{hour12:false})
  }
  tick(); setInterval(tick,1000)

  let viewDate=new Date()
  const viewDateEl=document.getElementById('viewDate'),calTitle=document.getElementById('calTitle'),calGrid=document.getElementById('calGrid')

  function pad(n){return (''+n).padStart(2,'0')}
  function keyOf(d){return d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate())}
  function fmt(d){return d.toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric',weekday:'short'})}

  let dated={}
  try{const raw=localStorage.getItem(KEY);dated=raw?JSON.parse(raw):{}}catch(_){dated={}}

  function baseline(d){
    const dow=d.getDay()
    return studentData.map(p=>{
      if(weekly[p.no] && weekly[p.no].has(dow)) return {no:p.no,status:'absent',reason:'학원',manual:false}
      return {no:p.no,status:'present',reason:'기타',manual:false}
    })
  }

  function loadFor(d){
    const key=keyOf(d)
    const saved=dated[key]
    const base=baseline(d)
    const merged=base.map(b=>{
      if(Array.isArray(saved)){
        const s=saved.find(x=>x&&x.no===b.no)
        if(s){
          const manual = s.manual===true || s.status!==b.status || s.reason!==b.reason
          if(manual) return {no:b.no,status:s.status,reason:s.reason,manual:true}
        }
      }
      return b
    })
    roster.forEach(p=>{
      const m=merged.find(x=>x.no===p.no)
      p.status=m.status
      p.reason=REASONS.includes(m.reason)?m.reason:'기타'
      p.manual=!!m.manual
    })
    if(!Array.isArray(saved)){dated[key]=merged;localStorage.setItem(KEY,JSON.stringify(dated))}
  }

  function saveFor(d){
    const key=keyOf(d)
    dated[key]=roster.map(p=>({no:p.no,status:p.status,reason:p.reason,manual:p.manual===true}))
    localStorage.setItem(KEY,JSON.stringify(dated))
  }

  function setView(d){
    viewDate=new Date(d.getFullYear(),d.getMonth(),d.getDate())
    viewDateEl.textContent=fmt(viewDate)
    loadFor(viewDate)
    renderCalendar();renderList();renderTimeline()
  }

  const WEEK_HEADER=['일','월','화','수','목','금','토']
  function renderCalendar(){
    calGrid.innerHTML=''
    const y=viewDate.getFullYear(),m=viewDate.getMonth()
    calTitle.textContent=y+'년 '+(m+1)+'월'
    WEEK_HEADER.forEach(dw=>{const h=document.createElement('div');h.className='cal-dow';h.textContent=dw;calGrid.appendChild(h)})
    const first=new Date(y,m,1),start=first.getDay(),days=new Date(y,m+1,0).getDate()
    const prevDays=start,prevMonthDays=new Date(y,m,0).getDate()
    for(let i=prevDays-1;i>=0;i--){const d=new Date(y,m-1,prevMonthDays-i);calGrid.appendChild(dayCell(d,true))}
    for(let day=1;day<=days;day++){const d=new Date(y,m,day);calGrid.appendChild(dayCell(d,false))}
    const total=7+prevDays+days,fill=49-total
    for(let i=1;i<=fill;i++){const d=new Date(y,m+1,i);calGrid.appendChild(dayCell(d,true))}
    function dayCell(d,other){const div=document.createElement('div');div.className='cal-day'+(other?' other':'');div.textContent=d.getDate();const today=new Date();if(d.toDateString()===today.toDateString())div.classList.add('today');if(d.toDateString()===viewDate.toDateString())div.classList.add('selected');div.addEventListener('click',()=>{setView(d);fit()});return div}
  }

  const gridEl=document.getElementById('grid')
  function renderList(){
    gridEl.innerHTML=''
    roster.forEach(p=>{
      const card=document.createElement('div');card.className='card '+p.status
      const btn=document.createElement('button');btn.className='status '+p.status;btn.innerHTML='<span class="pill"></span><span class="label">'+(p.status==='present'?'참여':'불참')+'</span>'
      btn.addEventListener('click',()=>{p.status=p.status==='present'?'absent':'present';if(p.status!=='absent')p.reason='기타';p.manual=true;saveFor(viewDate);upd();renderTimeline()})
      const sel=document.createElement('select');sel.className='reason';REASONS.forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;if(p.reason===r)o.selected=true;sel.appendChild(o)});sel.addEventListener('change',()=>{p.reason=sel.value;p.manual=true;saveFor(viewDate);renderTimeline()})
      card.innerHTML='<div class="no">'+p.no+'.</div><div class="name">'+p.name+'</div><div class="id">'+p.id+'</div>'
      const rw=document.createElement('div');rw.className='reason-wrap';rw.innerHTML='<span class="reason-label">불참 사유</span>';rw.appendChild(sel)
      card.appendChild(btn);card.appendChild(rw)
      function upd(){card.className='card '+p.status;btn.className='status '+p.status;btn.querySelector('.label').textContent=(p.status==='present'?'참여':'불참')}
      upd();gridEl.appendChild(card)
    })
  }

  document.getElementById('allPresent').addEventListener('click',()=>{roster.forEach(p=>{p.status='present';p.reason='기타';p.manual=true});saveFor(viewDate);renderList();renderTimeline()})
  document.getElementById('allAbsent').addEventListener('click',()=>{roster.forEach(p=>{p.status='absent';if(p.reason!=='학원')p.reason='기타';p.manual=true});saveFor(viewDate);renderList();renderTimeline()})
  document.getElementById('goToday').addEventListener('click',()=>{setView(new Date());fit()})

  const timelineEl=document.getElementById('timeline')
  function renderTimeline(){
    timelineEl.innerHTML=''
    const abs=roster.filter(p=>p.status==='absent').map(p=>({no:p.no,name:p.name,reason:p.reason})).sort((a,b)=>a.no-b.no)
    if(!abs.length){const e=document.createElement('div');e.className='tl-empty';e.textContent='이 날짜의 불참자가 없습니다.';timelineEl.appendChild(e);return}
    abs.forEach(a=>{const item=document.createElement('div');item.className='tl-item';item.innerHTML='<div class="tl-name">'+a.no+'. '+a.name+'</div><div class="tl-reason">'+a.reason+'</div>';timelineEl.appendChild(item)})
  }

  function fit(){const area=document.getElementById('fitArea');const headerH=document.querySelector('header').offsetHeight;const availH=document.body.clientHeight-headerH-28;const needH=area.scrollHeight;const scale=Math.min(1,availH/needH);area.style.transform='scale('+scale+')'}
  window.addEventListener('resize',fit)

  document.getElementById('prevMonth').addEventListener('click',()=>setView(new Date(viewDate.getFullYear(),viewDate.getMonth()-1,1)))
  document.getElementById('nextMonth').addEventListener('click',()=>setView(new Date(viewDate.getFullYear(),viewDate.getMonth()+1,1)))

  ;(function(){let last=new Date().toDateString();setInterval(()=>{const now=new Date();const s=now.toDateString();if(s!==last){last=s;setView(now);fit()}},60000)})()
  window.addEventListener('visibilitychange',()=>{if(!document.hidden){setView(new Date());fit()}})

  setView(new Date())
  fit()
</script>
</body>
</html>
